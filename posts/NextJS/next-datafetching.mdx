---
title: 'Data Fetching'
date: '2024-01-13'
description: 'next12,13ì—ì„œì˜ SSG, SSR / next13 client&server component'
category: 'NextJS'
thumbnail: '/thumbnail/nextjs.png'
---

## ëª©ì°¨

# NextJS 13 ë²„ì „ ì´ì „ ë°©ì‹

**SSG â†’ getStaticProps, getStaticPaths**

ê³µì‹ë¬¸ì„œì—ì„œ ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ì‚¬ìš©í•˜ê¸°ë¥¼ ì¶”ì²œí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ **<span className='highlight'>ë¹Œë“œíƒ€ì„ ë•Œ</span>**Â ë¯¸ë¦¬ HTMLì„ ìƒì„±í•´ ë†“ê³  ìš”ì²­ì´ ë“¤ì–´ì™”ì„ ë•Œ í•´ë‹¹ í˜ì´ì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. Data Fetchingì€ ë¹Œë“œíƒ€ì„ì— ì´ë£¨ì–´ì§€ê¸° ë•Œë¬¸ì— ì½˜í…ì¸ ê°€ ë„ˆë¬´ ìì£¼ ë°”ë€Œì§€ ì•ŠëŠ” í˜ì´ì§€ì— ì í•©í•©ë‹ˆë‹¤. revalidateë¼ëŠ” ì˜µì…˜ì„ ì£¼ë©´ ë§¤ë²ˆ ìƒˆë¡­ê²Œ ë¹Œë“œë¥¼ í•˜ì§€ ì•Šë”ë¼ë„ ì£¼ê¸°ì ìœ¼ë¡œ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.Â 

**SSR â†’ getServerSideProps**

ìƒˆë¡œìš´ ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œë§ˆë‹¤ **<span className='highlight'>ëŸ°íƒ€ì„ ë•Œ</span>** HTMLì„ ìƒì„±í•˜ê³  ë³´ì—¬ì£¼ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.
ì½˜í…ì¸ ê°€ ì£¼ê¸°ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ëŠ” ì†Œì…œë¯¸ë””ì–´ í”¼ë“œ ê°™ì€ ë‹¤ì´ë‚´ë¯¹í•œ ì½˜í…ì¸ ì— ì í•©í•©ë‹ˆë‹¤.


## 1. `getStaticProps`

Static Generationìœ¼ë¡œ ë¹Œë“œ í•  ë•Œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤. (ë¯¸ë¦¬ ë§Œë“¤ì–´ì¤Œ)

*ì‚¬ìš© í•´ì•¼í•  ë•Œ*

- ì™¸ë¶€ ë°ì´í„°(file system, API, DB â€¦ )ë¥¼ ë¯¸ë¦¬ ê°€ì ¸ì™€ì•¼ í•˜ëŠ” ê²½ìš°
- ë°ì´í„°ë¥¼ ê³µê°œì ìœ¼ë¡œ ìºì‹œí•  ìˆ˜ ìˆì„ ë•Œ (ì‚¬ìš©ìë³„ ì•„ë‹˜)
- í˜ì´ì§€ëŠ” ë¯¸ë¦¬ ë Œë”ë§ ë˜ì–´ì•¼ í•˜ê³  ë§¤ìš° ë¹¨ë¼ì•¼ í•  ë•Œ

```tsx
export default function Home({ posts }) { ... }

// ì„œë²„ì—ì„œ ë¹Œë“œ ì‹œ í•´ë‹¹í•¨ìˆ˜ê°€ í˜¸ì¶œëœë‹¤
export async function getStaticProps() {
  // ì™¸ë¶€ ë°ì´í„°ë¥¼ ë°›ê¸° (file system, API, DB, etc)
  // í•˜ì§€ë§Œ ì´ í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ í˜¸ì¶œí•˜ë©´ ì„±ëŠ¥ì´ ì €í•˜ë¨
  const data = await fetch('https://.../posts')
  const posts = await res.json()

  //  propsëŠ” ë¹Œë“œì‹œ Home ì»´í¬ë„ŒíŠ¸ì— ì „ë‹¬ëœë‹¤
  return {
    props: { posts }
  }
}
```

- *getStaticPropsí•¨ìˆ˜ ë‚´ë¶€ì—ì„œ APIí˜¸ì¶œì„ ìƒì„±í•˜ë©´ ì„±ëŠ¥ì´ ì €í•˜ëœë‹¤.*

## 2. `getStaticPath`

Static Generationìœ¼ë¡œ ë°ì´í„°ì— ê¸°ë°˜í•˜ì—¬ pre-renderì‹œ íŠ¹ì •í•œ ë™ì  ë¼ìš°íŒ… êµ¬í˜„ (pages/post/[id].js)

- HTML build ì‹œê°„ì— ë Œë”ë§ëœë‹¤.
- í˜ì´ì§€ì˜ ê²½ë¡œê°€ ì™¸ë¶€ë°ì´í„°ì— ë”°ë¼ ë‹¤ë¥¼ ë•Œ ì‚¬ìš©
- ë™ì  ê²½ë¡œë¥¼ í†µí•´ getStaticPropsí•  ë•Œ ê²½ë¡œ ëª©ë¡ì„ ì •ì˜í•´ì¤˜ì•¼ í•¨
- paths.paramsë¥¼ getStaticPropsë¡œ ë¦¬í„´í•´ì¤€ë‹¤.
- paramsì— ë¹Œë“œí•  í˜ì´ì§€ë¥¼ ë„£ì–´ì•¼í•œë‹¤.

NextJSëŠ” pre-renderì—ì„œ ì •ì ìœ¼ë¡œ getStaticPathsì—ì„œ í˜¸ì¶œí•˜ëŠ” ê²½ë¡œë“¤ì„ ê°€ì ¸ì˜¨ë‹¤.

```tsx
function Post({ post }) {
  const router = useRouter()
  //  getStaticProps() ëë‚˜ë©´ ì‹¤í–‰
  if (router.isFallback) {
    return <div>Loading...</div>
  }
  // Render post...
}

// idë¡œ ë™ì ê²½ë¡œ ë§Œë“œëŠ” ì˜ˆì‹œ- posts/1652
export async function getStaticPaths() {
  const res = await fetch('https://.../posts/')
  const posts = await res.json()
  const paths = posts.map((post) => ({
    params: { id: post.id },
  }))
  return {
    paths,
    fallback: true, // false or "blocking" 
  };
}
export async function getStaticProps({ params }) {
  // params contains the post `id`.
  // If the route is like /posts/1, then params.id is 1
  const res = await fetch(`https://.../posts/${params.id}`)
  const post = await res.json()

  // Pass post data to the page via props
  return { props: { post } }
}
```

`paths`

- ì–´ë– í•œ ê²½ë¡œê°€ pre-render ë ì§€ë¥¼ ê²°ì •
- ex) pages/posts/[id].js â‡’ `paths: [{ params: {id: '1' }}, { params: {id: '2' }}]`

`fallback`

- falseë¼ë©´ getStaticPathsë¡œ ë¦¬í„´ë˜ì§€ ì•ŠëŠ” ê²ƒì€ ëª¨ë‘ 404í˜ì´ì§€ë¡œ ëœ¬ë‹¤.
- trueë¼ë©´ getStaticPathsë¡œ ë¦¬í„´ë˜ì§€ ì•ŠëŠ” ê²ƒì€ 404ë¡œ ëœ¨ì§€ ì•Šê³  fallback í˜ì´ì§€ê°€ ëœ¨ê²Œ ëœë‹¤.

```tsx
// fallback í˜ì´ì§€ ì§€ì •
if(router.isFallback) {
	return <div>Loading...</div>
}
```

## 3. `getServerSideProps`

SSRë¡œ ìš”ì²­ì´ ìˆì„ ë•Œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤.

í•´ë‹¹ í•¨ìˆ˜ëŠ” í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ importë˜ì§€ ì•Šê³  ì§ì ‘ ì„œë²„ ì¸¡ ì½”ë“œ(dbì—ì„œ fetch ë“±)ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

*ì‚¬ìš© í•´ì•¼í•  ë•Œ*

- ìì£¼ ë³€ê²½ë˜ëŠ” ìµœì‹  ë°ì´í„°ë¥¼ í˜ì´ì§€ì— ì—…ë°ì´íŠ¸ì‹œí‚¬ ë•Œ ì‚¬ìš©
- ìš”ì²­í•  ë•Œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì•¼í•˜ëŠ” í˜ì´ì§€ë¥¼ ë¯¸ë¦¬ ë Œë”ë§í•´ì•¼ í•  ë•Œ ì‚¬ìš©
- ì„œë²„ê°€ ëª¨ë“  ìš”ì²­ì— ëŒ€í•œ ê²°ê³¼ë¥¼ ê³„ì‚°í•˜ê³ , ì¶”ê°€ êµ¬ì„±ì—†ì´ CDNì— ì˜í•´ ê²°ê³¼ë¥¼ ìºì‹œí•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì²«ë²ˆì§¸ ë°”ì´íŠ¸ê¹Œì§€ì˜ ì‹œê°„ì€ getStaticProsë³´ë‹¤ ëŠë¦¬ë‹¤.

```tsx
export async function getServerSideProps(context) {
  const res = await fetch(`https://.../data`);
  const data = await res.json();

  return {
    props: { data }, 
  }
}
```
---

# NextJS 13

**SSG => `cache: "force-cache"`**

**SSR => `cache: "no-store"`**

## fetch()

- `async/await`ë¥¼ ì‚¬ìš©í•œ `fetch()` API ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½
- appí´ë” ì‚¬ìš© ì‹œ(app router ì‚¬ìš© ì‹œ) `getStaticProps`, `getServerSideProps` ë“± ì´ì „ ë°©ë²•ì€ í•´ë‹¹í´ë”ì—ì„œëŠ” ì§€ì› ì•ˆëœë‹¤.
- *fetch ì˜µì…˜*ì„ í†µí•´ `getStaticProps`, `getServerSideProps` ì²˜ëŸ¼ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.

### ğŸ§‘ğŸ»â€ğŸ’»Â ì½”ë“œ ì˜ˆì‹œ

ê¸°ë³¸ í˜•íƒœ

```tsx
export async function fetchData() {
  const res = await fetch(`https://.../data`);
  const data = await res.json();
  return data;
}
```

fetch ì˜µì…˜ í™œìš© `fetch(url, option)`

```tsx
// This request should be cached until manually invalidated.
// Similar to `getStaticProps`.
// `force-cache` is the default and can be omitted.
const staticData = await fetch(`https://...`, { cache: 'force-cache' });

// This request should be refetched on every request.
// Similar to `getServerSideProps`.
const dynamicData = await fetch(`https://...`, { cache: 'no-store' });

// This request should be cached with a lifetime of 10 seconds.
// Similar to `getStaticProps` with the `revalidate` option.
const revalidatedData = await fetch(`https://...`, {
  next: { revalidate: 10 },
});
```

- `{ cache: 'force-cache' }` : ê¸°ë³¸ê°’ìœ¼ë¡œ ìƒëµ ê°€ëŠ¥ â†’ ìºì‹œê°€ ì˜¤ë˜ë˜ë”ë¼ë„ ìºì‹œë¥¼ ì‚¬ìš©í•˜ì—¬ ì†ë„ë¥¼ ìš°ì„  (SSG)
- `{ cache: 'no-store' }` : ëª¨ë“  ìš”ì²­ì—ì„œ ìµœì‹  ë°ì´í„° ë°›ì•„ì˜¤ê¸° â†’ ìºì‹œë¥¼ ì™„ì „íˆ ìš°íšŒí•˜ì—¬ ì‹ ì„ ë„ë¥¼ ìš°ì„  (SSR)
- `next: { revalidate: 10 }` :  Revalidating Data, ìºì‹œëœ ë°ì´í„°ë¥¼ ì¼ì • ì‹œê°„ ê°„ê²©ìœ¼ë¡œ ì¬ê²€ì¦í•œë‹¤. ê¸°ë³¸ ë‹¨ìœ„ëŠ” ì´ˆ

## pre-render 
pre-renderì˜ ê²½ìš° `getStaticPaths`ì—ì„œ `generateStaticParams`ë¡œ ë³€ê²½
```tsx
// Return a list of `params` to populate the [slug] dynamic segment
export async function generateStaticParams() {
  const posts = await fetch('https://.../posts').then((res) => res.json())
 
  return posts.map((post) => ({
    slug: post.slug,
  }))
}
 
// Multiple versions of this page will be statically generated
// using the `params` returned by `generateStaticParams`
export default function Page({ params }) {
  const { slug } = params
  // ...
}
```

## Server & Client Component

NextJS 13ë¶€í„° ì»´í¬ë„ŒíŠ¸ ìˆ˜ì¤€ì—ì„œë„ ë Œë”ë§ í™˜ê²½ì„ ì„ íƒí•  ìˆ˜ ìˆê²Œ ë³€ê²½

### Server Component

NextJS 13 ë²„ì „ì˜ app directory ì•ˆì— ìˆëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë“¤ì€ ê¸°ë³¸ì ìœ¼ë¡œ React Server Componentì´ë‹¤. 

ì´ëŠ” ê°œë°œìê°€ ì„œë²„ ì¸í”„ë¼ë¥¼ ë” ì˜ í™œìš©í•  ìˆ˜ ìˆê²Œ í•œë‹¤. 

- ì„œë²„ ì»´í¬ë„ŒíŠ¸ëŠ” ë³µì¡í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬ì¶•í•˜ëŠ” ë™ì‹œì— í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ì†¡ë˜ëŠ” JavaScriptì˜ ì–‘ì„ ì¤„ì—¬, ì´ˆê¸° í˜ì´ì§€ ë¡œë“œ ì†ë„ë¥¼ ë†’ì¼ ìˆ˜ ìˆìŒ
- ë˜í•œ, ê²½ë¡œ(route)ê°€ ë¡œë“œë  ë•Œ, Next.js ë° React ëŸ°íƒ€ì„ì´ ë¡œë“œë˜ì–´ ìºì‹œê°€ ê°€ëŠ¥í•˜ê³  í¬ê¸°ë¥¼ ì˜ˆì¸¡í•  ìˆ˜ ìˆìŒ

### Client Component

í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ client-side interactivityë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤. NextJS ì—ì„œëŠ” ì„œë²„ì—ì„œ pre-renderingë˜ê³  clientì—ì„œ hydrateëœë‹¤. íŒŒì¼ì˜ ìµœìƒë‹¨ì—  `use client` ë¼ëŠ” directiveë¥¼ ì¨ì„œ ì‚¬ìš©í•œë‹¤.

```tsx
// Client Component
'use client'
import React from 'react';
...

// Server Component
// => ë³„ë„ì˜ ëª…ì‹œ ì‘ì—…ì´ í•„ìš”ì—†ë‹¤.
```

### ê°ê°ì˜ ì»´í¬ë„ŒíŠ¸ë“¤ì„ ì–¸ì œ ì‚¬ìš©í•´ì•¼í• ê¹Œ? ğŸ¤”

|  | Server Component | Client Component |
| --- | --- | --- |
| Fetch Data | âœ… | âš ï¸Â (React-Queryì˜ ê²½ìš° ì‚¬ìš©) |
| ë°±ì—”ë“œ resourceì— ì ‘ê·¼ | âœ… | âŒ |
| ì„œë²„ì— ì¤‘ìš”í•œ ì •ë³´ ì €ì¥<br />(access token , API keys ë“±) | âœ… | âŒ |
| ì„œë²„ì— ëŒ€í•œ ì˜ì¡´ì„± ìœ ì§€ / client-sideì˜ JSë¥¼ ì¤„ì¼ ë•Œ | âœ… | âŒ |
| ìƒí˜¸ì‘ìš©ê³¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€<br />(onClick(), onChange() ë“±) | âŒ | âœ… |
| useStateì™€ Life Cycle Effectë“¤<br />(useState(), useReducer(), useEffect() ë“±)| âŒ | âœ… |
| browser-only APIsë¥¼ ì‚¬ìš©í•  ë•Œ<br />(localStorage, sessionStorage, Cookie ë“±)| âŒ | âœ… |
|ìƒíƒœë‚˜ effects, broser-only APIsì— ì˜ì¡´í•˜ëŠ”<br />ì»¤ìŠ¤í…€ í›…ì„ ì‚¬ìš©í•  ë•Œ| âŒ | âœ… |
|Reactì˜ í´ë˜ìŠ¤ ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©| âŒ | âœ… |