---
title: 'JWT'
date: '2023-08-07'
description: 'OAuth, JWTκµ¬μ„±, μ‘λ™λ°©μ‹, μ„¤μΉ λ° μ‚¬μ©(μƒμ„±, κ²€μ¦)'
category: 'NodeJS'
thumbnail: '/thumbnail/nodejs.png'
---

## λ©μ°¨

# OAuthλ€?

- OAuth(Open Authorization)λ€ μΈν„°λ„· μ‚¬μ©μλ“¤μ΄ <span className='highlight'>λΉ„λ°€λ²νΈλ¥Ό μ κ³µν•μ§€ μ•κ³  λ‹¤λ¥Έ μ›Ήμ‚¬μ΄νΈ μƒμ μμ‹ λ“¤μ μ •λ³΄μ— λ€ν•΄ μ ‘κ·Ό κ¶ν•μ„ λ¶€μ—¬ν• μ μλ” κ³µν†µμ μΈ μλ‹¨</span>μΌλ΅μ„ μ‚¬μ©λλ” ν”„λ΅ν† μ½
- <span className='highlight'>Access Token</span>μ„ ν†µν•΄ κ¶ν•μ„ λ¶€μ—¬ν•κ³ , μ‚¬μ©μμ μ‹¤μ  λΉ„λ°€ μ •λ³΄λ¥Ό κ³µμ ν•μ§€ μ•λ”λ‹¤.

# π™Β JWT (JSON Web Token)

- μ›Ή μ• ν”λ¦¬μΌ€μ΄μ… μ •λ³΄λ¥Ό μ•μ „ν•κ² μ „μ†΅ν•κΈ° μ„ν• κ°„λ‹¨ν• λ°©λ²•
- μΈμ¦λ μ‚¬μ©μλ¥Ό μ‹λ³„ν•κ±°λ‚ λ°μ΄ν„°μ— μ„λ…μ„ ν•μ—¬ λ³€μ΅°λ¥Ό λ°©μ§€ν•λ”λ° μ‚¬μ©
- **<span className='green-bold'>μΏ ν‚¤, μ„Έμ…μ λ€μ©μΌλ΅ μ‚¬μ©ν•λ‹¤.</span>**

## JWT κµ¬μ„±

1. **Header**: ν† ν°μ νƒ€μ…κ³Ό ν•΄μ‹ μ•κ³ λ¦¬μ¦ μ •λ³΄κ°€ ν¬ν•¨
2. **Payload**: μ‹¤μ  μ •λ³΄ λ°μ΄ν„°κ°€ ν¬ν•¨λλ©°, ν΄λ μ„μ΄λΌ λ¶λ¦¬λ” ν‚¤-κ°’ μμΌλ΅ μ΄λ£¨μ–΄μ Έ μμ
3. **Signature**: ν† ν°μ λ¬΄κ²°μ„±μ„ κ²€μ¦ν•κΈ° μ„ν• μ„λ… λ¶€λ¶„μΌλ΅, Headerμ™€ Payload μ΅°ν•©μ— secret Keyλ¥Ό μ‚¬μ©ν•΄ μƒμ„±
    
    λ¬΄κ²°μ„±: μ •ν™•μ„±,μΌκ΄€μ„±,μ ν¨μ„±μ΄ μ μ§€λλ” κ²ƒ
    

![jwt1](https://github.com/cheolung12/blog-static/assets/109952479/1c7e23f5-f500-4390-a4a4-77236992b112)

## JWT μ‘λ™λ°©μ‹

![jwt2](https://github.com/cheolung12/blog-static/assets/109952479/72bbba1f-49b7-4c77-827c-d1dded98148f)

## β™οΈΒ μ„¤μΉ

```bash
npm i jsonwebtoken
```

## π§‘π»β€π’»Β μ‚¬μ©

```jsx
const jwt = require("jsonwebtoken");

// μ‹ν¬λ¦Ών‚¤ μ„¤μ •
const SECRET = '2vWRUaRPjN';

...
```

- ν‚¤λ” [random key generator](https://randomkeygen.com/)μ—μ„ κ°€μ Έμ΄
- secretKeyλ” μ„λ²„μΈ΅μ—μ„λ§ μ•κ³ μλ” ν‚¤, μƒμ„±κ³Ό κ²€μ¦μ—μ„ μ‚¬μ©, λ³΄μ•μ„ μ„ν•΄ λ‹Ήν™κ²½λ³€μλ‚ .env μ‚¬μ©

### JWT μƒμ„±: `sign()`

```jsx
app.post('/login', (req, res) => {
	  // uuid, μ΄λ¦„ λ“± λ„£μΌλ©΄ λ¨
    const { id } = req.body;
    // jwt μƒμ„±
    // signν•¨μμ λ§¤κ°λ³€μλ“¤μ„ μ΅°ν•©ν•΄ ν† ν°μ„ μƒμ„±
    const token = jwt.sign({id}, secret);
    res.send({result: true, token});
});
```

![jwt3](https://github.com/cheolung12/blog-static/assets/109952479/bc105496-e757-4820-bfb0-36f12bc061b3)

μƒμ„±λ ν† ν°μ„ https://jwt.io/μ— λ¶™μ—¬λ„£μΌλ©΄ κ²°κ³Όκ°€ λ‚μ¤λ” κ±Έ ν™•μΈν•  μ μλ‹¤.

λ³΄ν†µ λ³΄λ‚Έ ν† ν°μ€ ν΄λΌμ΄μ–ΈνΈμ—μ„ λ΅μ»¬μ¤ν† λ¦¬μ§€λ‚, μ„Έμ…μ¤ν† λ¦¬μ§€μ— μ €μ¥ν•λ‹¤.

μΏ ν‚¤λ΅λ„ ν† ν°μ„ λ³΄λ‚Ό μ μμΌλ‚ λ§μ΄ μ‚¬μ©ν•λ” λ°©λ²•μ€ μ•„λ‹

### JWT κ²€μ¦: `verify()`

ν΄λΌμ΄μ–ΈνΈ μΈ΅μ—μ„ JWT ν† ν°μ„ ν—¤λ”μ— ν¬ν•¨ν•΄ λ³΄λ‚Έλ‹¤λ©΄ μ„λ²„μ—μ„λ” κ²€μ¦ κ³Όμ •μ„ κ±°μ³μ•Ό ν•λ‹¤.

```jsx
// ν΄λΌμ΄μ–ΈνΈ: μ”μ²­
	(async function () {
	  ...
	      const res = await axios({
	          method: 'GET',
	          url: '/token',
	          headers: {
	              Authorization: `Bearer ${token}`,
	          },
	      });
	      console.log('res', res.data);
	  ...
  })();
```

- headersμ Authorizationμ— μ„μ™€ κ°™μ€ λ°©μ‹μΌλ΅ ν† ν°μ¶”κ°€ν•΄μ„ μ”μ²­
- μ¦‰μ‹μ‹¤ν–‰ν•¨μλ¬Έλ²•  (await μ‚¬μ©ν•κΈ° μ„ν•΄μ„ μ‚¬μ©ν•¨)
    
    ```jsx
    (function () {
        // statements
    })()
    ```
    

```jsx
// μ„λ²„: κ²€μ¦
app.post('/verify', (req,res) => {
    console.log(req.headers);
    const auth = req.headers.authorization;
    const token = auth.split(' ')[1];
      // jwt κ²€
      // κ²€μ¦ κ³Όμ •μ€ κΈ€λ΅λ² ν•¨μλ΅ λ§λ“¤μ–΄λ„£κ³  κ³„μ† μ“°λ©΄λλ‹¤.
      jwt.verify(token, secret, (err, decoded) => {
          if(err){
              return res.status(403).send({ msg: 'κ²€μ¦μ‹¤ν¨'});
          }
          res.send({user: decoded});
      });
});
```

- req.headersμ λ‚΄μ©μ€ λ‹¤μκ³Ό κ°™λ‹¤
    
    ![jwt4](https://github.com/cheolung12/blog-static/assets/109952479/86470851-7e34-431d-923a-826bab97e2cf)
    
    `authorization: Bearer ν† ν°` μ΄λ°ν•νƒ.
    
    λ”°λΌμ„ `split(β€™ β€)`μ„ ν™μ©ν•΄  Bearerλ¬Έμμ—΄μ€ λΉΌκ³  ν† ν°λ¶€λ¶„λ§ λ–Όμ¨λ‹¤.
    
- `verify(ν† ν°, μ‹ν¬λ¦Ών‚¤, μ½λ°±ν•¨μ)`
    
    μ½λ°±ν•¨μμ—μ„λ” μ—λ¬μ²λ¦¬ λ΅μ§μ„ λ„£λ”λ‹¤. 
    
    decodedκ²°κ³Όλ¥Ό ν™•μΈν•κΈ° μ„ν•΄ ν¬μ¤νΈλ§¨μΌλ΅ ν…μ¤νΈ
    
    ![jwt5](https://github.com/cheolung12/blog-static/assets/109952479/68a23cb2-84b7-4e20-8fc6-f1bbad1d8197)
    
    - κ²€μ¦ ν›„ μ •λ³΄κ°€ μ μ „μ†΅λκ±Έ ν™•μΈν•  μ μλ‹¤.
    - iat: issued at μΌλ΅ JWT λ°κΈ‰λ μ‹κ°„μ„ λ‚νƒ€λƒ„