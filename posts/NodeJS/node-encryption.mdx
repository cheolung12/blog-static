---
title: 'μ•”νΈν™”'
date: '2023-08-08'
description: 'λ‹¨λ°©ν–¥/μ–‘λ°©ν–¥ μ•”νΈν™”, λ³µνΈν™”'
category: 'NodeJS'
thumbnail: '/thumbnail/nodejs.png'
---

## λ©μ°¨

# π”‘Β μ•”νΈν™” μΆ…λ¥

![en1](https://github.com/cheolung12/blog-static/assets/109952479/863b6da6-5bd0-47f6-9c7c-5a1ca6080d9c)

![en2](https://github.com/cheolung12/blog-static/assets/109952479/092bbb48-e910-421f-9bd2-378d4e07a64e)

## β΅οΈΒ λ‹¨λ°©ν–¥ μ•”νΈν™”

- **<span className='red-bold'>Hash</span>** λ¥Ό μ‚¬μ©ν•λ‹¤.
- λ‹¨λ°©ν–¥μ΄λ―€λ΅ **<span className='red-bold'>μ›λ³Έ λ°μ΄ν„°λ¥Ό λ³µμ›ν•  μ μ—†λ‹¤.</span>**
- λ™μΌν• λ°μ΄ν„°μ— λ€ν•΄μ„λ” ν•­μƒ λ™μΌν• ν•΄μ‹ κ°’μ΄ μƒμ„±λλ‹¤.
    
    μ„λ΅ λ‹¤λ¥Έ λ°μ΄ν„°μ— λ€ν•΄μ„λ„ κ°™μ€ ν•΄μ‹ κ°’μ΄ λ‚μ¬ μ μμ (μ¶©λ)
    
- λ―Έμ„Έν• λ°μ΄ν„° λ³€ν™”μ—λ„ ν•΄μ‹ κ°’μ€ μ™„μ „ν λ‹¤λ¦„.

## π§¬Β ν•΄μ‹

- ν•΄μ‹ ν•¨μμ— μν•΄ μ–»μ–΄μ§€λ” κ°’
- **<span className='blue-bold'>ν•΄μ‹ ν•¨μ (ν•΄μ‹ μ•κ³ λ¦¬μ¦)</span>**
    - μ„μμ ν¬κΈ°μ λ°μ΄ν„°λ¥Ό κ³ μ •λ ν¬κΈ°μ λ°μ΄ν„°λ΅ λ³€ν™ν•λ” ν•¨μ
    - ν‚¤: λ§¤ν•‘ μ „ μ›λ λ°μ΄ν„°μ κ°’
    - ν•΄μ‹ κ°’: λ§¤ν•‘ ν›„ λ°μ΄ν„° κ°’
    - ν•΄μ‹±: λ§¤ν•‘ν•λ” κ³Όμ •
    - ex) SHA-256, SHA-512β€¦
    

## β†”οΈΒ μ–‘λ°©ν–¥ μ•”νΈν™”

- λ°μ΄ν„°μ κΈ°λ°€μ„±μ„ μ μ§€ν•κ±°λ‚ **<span className='green-bold'>μ•μ „ν• ν†µμ‹ μ„ μ„ν•΄ μ‚¬μ©</span>**
- λ€μΉ­ν‚¤ μ‚¬μ©: μ•”νΈν™”μ™€ λ³µνΈν™”μ— <span className='green-bold'>λ™μΌν• ν‚¤</span>λ¥Ό μ‚¬μ©ν•λ―€λ΅ ν‚¤ κ΄€λ¦¬κ°€ μ¤‘μ”
- λΉ„λ°€λ²νΈ λ³΄λ‹¤λ” λ¬Έμ„ μ•”νΈν™”μ— μ‚¬μ©
- AES(Advanced Encryption Standard)
    - λ‹¤μ–‘ν• ν‚¤(λΉ„λ°€ κ°’)μ™€ λΈ”λ΅(μ•”νΈν™”ν•  λ°μ΄ν„°)μ„ μ κ³µ
    - λΉ λ¥Έ μ²λ¦¬μ†λ„, λ‹¤μ–‘ν• ν”λ«νΌμ—μ„ κµ¬ν„μ΄ μ©μ΄
    - ECB, CBC β€¦

---

# π”‘Β μ•”νΈν™” μ‹¤μµ (λ‹¨λ°©ν–¥)

```jsx
const crypto = require("crypto");
```

- `crypto` : μ•”νΈν™” μ•κ³ λ¦¬μ¦μ΄ λ¨μ—¬μλ” ν¨ν‚¤μ§€, μµμ¤ν”„λ μ¤ λ¨λ“μ— λ‚΄μ¥λμ–΄ μμ–΄ μ„¤μΉκ³Όμ •μ΄ λ”°λ΅ ν•„μ”μ—†λ‹¤.

## π”Β Pbkdf2(Sync)

```jsx
// λ³΄ν†µ listen μ•„λ λ¶€λ¶„μ— ν•¨μ μ„ μ–Έν•¨
const SALT = crypto.randomBytes(16).toString('base64');
const ITER = 100;   // λ°λ³µ νμ
const KEY_LEN = 64; // μƒμ„± ν•  ν‚¤μ κΈΈμ΄
const ALGO = 'sha512';

const createPbkdf = (password) => {
  // pbkdf2ν•¨μ(λΉ„λ°€λ²νΈ, μ†™νΈ, λ°λ³µνμ, ν‚¤μ κΈΈμ΄, μ•κ³ λ¦¬μ¦)
  // λ°ν™λλ” κ°’μ€ λ²„νΌκ°’
  const hash = crypto.pbkdf2Sync(password, salt, iter, keylen, algo);
  return hash.toString('base64');
};

// κ²€μ¦
const verifyPassword = (password, salt, dbPassword) => {
  const compare = crypto
    .pbkdf2Sync(password, salt, iter, keylen, algo)
    .toString('base64');
  if (compare === dbPassword) {
    return true;
  }
  return false;
};

```

- `pbkdf2(Sync)` : λΉ„λ°€λ²νΈ κΈ°λ° ν‚¤ λ„μ¶ ν•¨μ
- μ•”νΈν™” λ³΄μ™„λ²•
    - `SALT` κ°’: μ…λ ¥κ°’μ— saltλΌλ” νΉμ •ν• κ°’μ„ λ¶™μ—¬ μ¶λ ¥κ°’μ„ λ³€ν•μ‹ν‚΄
    - `ITER` : ν•΄μ‹ ν•¨μλ¥Ό μ—¬λ¬λ² λλ ¤ λ³Έλμ κ°’μ„ μμΈ΅ν•κΈ° μ–΄λ µκ² ν•¨
- `base64`: 64κ°μ κ°€λ¥ν• λ¬Έμλ΅ λ°μ΄ν„°λ¥Ό μΈμ½”λ”©ν•λ” λ°©μ‹
- λ‹¨λ°©ν–¥μ΄κΈ° λ•λ¬Έμ— κ²€μ¦λ‹¨κ³„μ—μ„λ” λ‹¨μν κ°™μ€ κ°’μ„ λ„£μ–΄ κ°™μ€ κ²°κ³Όκ°€ λ‚μ¤λ©΄ λλ‹¤.

## π”Β Bcrypt

```bash
npm i bcrypt
```

```jsx
// bcrypt (λ‹¨λ°©ν–¥)
const bcrypt = require('bcrypt');
const saltNumber = 10;   // μ•”νΈν™”μ— μ‚¬μ©ν•  salt μ„¤μ •, μ •μμ‚¬μ©

// μ•”νΈν™”
const bcryptPassword = (password) => {
  return bcrypt.hashSync(password, saltNumber);
};

// κ²€μ¦
const comparePassword = (password, dbPassword) => {
  return bcrypt.compareSync(password, dbPassword);
};
```

- Pbkdf2μ™€ λ§μ°¬κ°€μ§€λ΅ λΉ„λ°€λ²νΈλ¥Ό μ•”νΈν™” ν•λ” μ•κ³ λ¦¬μ¦ μ¤‘ ν•λ‚
- λ³΄μ•μ΄ λ” κ°•λ ¥ν•¨
- μ‹¬μ§€μ–΄ κ°„λµν•΄μ„ μ‚¬λλ“¤μ΄ λ§μ΄ μ”€

# π”‘μ•”νΈν™” / λ³µνΈν™” μ‹¤μµ (μ–‘λ°©ν–¥)

```jsx
// μ–‘λ°©ν–¥
const algorithm = 'aes-256-cbc'; // 256λΉ„νΈ ν‚¤λ¥Ό μ‚¬μ©, λΈ”λ΅ ν¬κΈ°λ” 128λΉ„νΈ
const key = crypto.randomBytes(32);
const iv = crypto.randomBytes(16); // μ΄κΈ°ν™” λ²΅ν„°κ°’, λ°μ΄ν„°λΈ”λ΅μ„ μ•”νΈν™”ν•  λ• λ³΄μ•μ„±μ„ λ†’μ΄κΈ° μ„ν•΄ μ‚¬μ©

// μ•”νΈν™”
// λΉ„λ°€λ²νΈλ³΄λ‹¤λ” λ¬Έμ„λ‚ ν†µμ‹  μ½μ΄μ—μ„ μ‚¬μ©ν•΄μ„ word λΌκ³  μ‚¬μ©
const cipherEncrypt = (word) => {
  const cipher = crypto.createCipheriv(algorithm, key, iv); // μ•”νΈν™” κ°μ²΄ μƒμ„±
  let encryptedData = cipher.update(word, 'utf-8', 'base64'); // μ•”νΈν™”ν•  λ°μ΄ν„° μ²λ¦¬
  console.log(encryptedData);
  encryptedData += cipher.final('base64'); // μµμΆ…κ²°κ³Ό μƒμ„±
  return encryptedData;
};

// λ³µνΈν™”
const decipher = (encryptedData) => {
  const decipher = crypto.createDecipheriv(algorithm, key, iv); // λ³µνΈν™” κ°μ²΄ μƒμ„±
  let decryptedData = decipher.update(encryptedData, 'base64', 'utf-8'); // λ³µνΈν™”ν•  λ°μ΄ν„° μ²λ¦¬
  decryptedData += decipher.final('utf-8');
  return decryptedData;
};
```

- λΉ„λ°€λ²νΈ μ•”νΈν™”κ°€ μ•„λ‹λΌμ„ μΈμƒμ—μ„ μ“Έ μΌ μ—†μ„κ±° κ°™κΈ΄ ν•¨
- λ³µνΈν™”μ‹ μ•”νΈν™”λ λ¬Έμ„κ°€ λ‹¤μ‹ μ›λ³ΈμΌλ΅ λ‚μ΄
- μ•”νΈν™”λ ν‚¤λ΅ κ²€μ¦ν•΄μ•Όν•λ―€λ΅ ν‚¤ κ΄€λ¦¬κ°€ μ¤‘μ”!