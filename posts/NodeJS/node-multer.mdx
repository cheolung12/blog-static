---
title: 'íŒŒì¼ ì—…ë¡œë“œ (with multer)'
date: '2023-08-02'
description: 'multerë¥¼ í™œìš©í•œ ë™ê¸°/ë¹„ë™ê¸° íŒŒì¼ ì „ì†¡'
category: 'NodeJS'
thumbnail: '/thumbnail/nodejs.png'
---

## ëª©ì°¨

# ğŸ“ŒÂ body-parserì˜ í•œê³„

```jsx
app.use(express.urlencoded({extended: true}));
app.use(express.json());
```

- postë¡œ ì •ë³´ë¥¼ ì „ì†¡í•  ë•Œ ìš”ì²­ì˜ body(req.body)ë¡œ ë°›ì„ ìˆ˜ ìˆê²Œ ë„ì™€ì¤€ë‹¤.
- **<span className='red-bold'>ë‹¨, ë©€í‹°íŒŒíŠ¸ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ì§€ ëª»í•œë‹¤</span>**
    
    ë©€í‹°íŒŒíŠ¸ ë°ì´í„° : ì´ë¯¸ì§€, ë™ì˜ìƒ, íŒŒì¼ ë“±ë“±
    
    â†’ **<span className='blue-bold'>multer ëª¨ë“ˆì„ ì´ìš©! (npm i multer)</span>**
    

---

# ğŸ“ŒÂ multer

```html
<!-- í´ë¼ì´ì–¸íŠ¸ -->
<form action="/upload" method="post" enctype="multipart/form-data">
    <input type="file" name="userFile" /><br />
    <input type="text" name="title" /><br />
    <button type="submit">ì—…ë¡œë“œ</button>
</form>
```

- `enctype='multipart/formdata'`  : multerê°€ ë™ì‘í•˜ëŠ” í™˜ê²½ìœ¼ë¡œ ì„¤ì •

## 1ï¸âƒ£Â  í•˜ë‚˜ì˜ íŒŒì¼ ì—…ë¡œë“œ

```jsx
// ì„œë²„
const multer = require("multer");
...

// multer ì„¤ì • (ì½”ë“œ ìœ„ì¹˜: ìƒë‹¨)
const upload = multer({
    dest: 'uploads/'    
})

app.post('/upload', upload.single('userFile'), (req, res) => {
    console.log(req.file);
    console.log(req.body);
})
...
```

- `dest: uploads/` : ì—…ë¡œë“œí•  íŒŒì¼ì„ ì €ì¥í•  ê²½ë¡œ ì§€ì •, ìƒëŒ€ê²½ë¡œë„ ê°€ëŠ¥
    
    ìœ„ì½”ë“œ ìƒì—ì„œëŠ” uploadsí´ë”ë¥¼ ìƒì„± í›„ ê·¸ ì•ˆì— íŒŒì¼ì„ ì €ì¥í•œë‹¤.
    
- `upload.single('userFile')`
    
    single : í•˜ë‚˜ì˜ íŒŒì¼ ì—…ë¡œë“œ
    
    userFile : ìœ„ ejsíŒŒì¼ì—ì„œ input:file íƒœê·¸ì˜ nameì†ì„±
    
    postí•¨ìˆ˜ì˜ ë‘ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ë¡œ ì…ë ¥ â†’ ì½œë°±í•¨ìˆ˜ëŠ” í•­ìƒ ë§ˆì§€ë§‰ ë§¤ê°œë³€ìˆ˜ë‹ˆê¹Œ
    
- `req.file` : í•˜ë‚˜ì˜ íŒŒì¼ì´ê¸°ë•Œë¬¸ì— fileì„ ë‚˜ì¤‘ì— files ë‚˜ì˜´
    
    ![multer1](https://github.com/cheolung12/blog-static/assets/109952479/a30e1765-a2a0-420c-ac71-e8c8f8988296)
    
    ì—…ë¡œë“œ ì„±ê³µí•˜ë©´ ì´ë ‡ê²Œ ëœ¸
    

## ì—…ë¡œë“œ ì„¸ë¶€ ì„¤ì •

![multer2](https://github.com/cheolung12/blog-static/assets/109952479/951077f2-aafc-4a20-87c4-a71776fe88b9)

ì—…ë¡œë“œëŠ” ì˜ ë˜ì—ˆì§€ë§Œ íŒŒì¼ì´ë¦„ì´ ë§¤ìš° ì´ìƒí•˜ê³  ì—´ë¦¬ì§€ ì•ŠëŠ” í˜„ìƒì´ ë°œìƒí•œë‹¤. â†’ ì—…ë¡œë“œ ì„¸ë¶€ì„¤ì •ìœ¼ë¡œ ê³ ì³ì£¼ì!

```jsx
const path = require("path"); // ìµìŠ¤í”„ë ˆìŠ¤ ë‚´ì¥ ê°ì²´ : ê²½ë¡œ ì„¤ì • ë° ì œì–´
...

// ì„¸ë¶€ì„¤ì •
const uploadDetail = multer({
  // storage: ì €ì¥í•  ê³µê°„ì— ëŒ€í•œ ì •ë³´
  // diskStorage: íŒŒì¼ì„ ë””ìŠ¤í¬ì— ì €ì¥í•˜ê¸° ìœ„í•œ ëª¨ë“  ì œì–´ ê¸°ëŠ¥ì„ ì œê³µ
  // done(ì½œë°±í•¨ìˆ˜ -> ì—ëŸ¬ì²˜ë¦¬, ì €ì¥í•  ë””ë ‰í† ë¦¬ ê²½ë¡œ)
  storage: multer.diskStorage({
    destination(req, file, done) {
      done(null, "uploads/");
    },
    filename(req, file, done) {
      // í™•ì¥ìëª… ì¶”ì¶œ (ex) .jpeg)
      const ext = path.extname(file.originalname);
      console.log("ext", ext);
			// done(ì—ëŸ¬ì²˜ë¦¬, ì €ì¥í•  íŒŒì¼ì˜ ì´ë¦„)
      // í™•ì¥ìê°€ ì—†ì–´ì§„ ì›ë˜ ì´ë¦„ ì¶”ì¶œ(basename) + í˜„ì¬ íƒ€ì„ìŠ¤íƒ¬í”„ê°’ + í™•ì¥ì
      done(null, path.basename(file.originalname, ext) + Date.now() + ext);
    },
  }),
	// íŒŒì¼ì˜ í¬ê¸° ì œí•œ (ì—¬ê¸°ì„œëŠ” ìµœëŒ€ 5MB)
  limits: { fileSize: 5 * 1024 * 1024 },
});

...

app.post("/upload", uploadDetail.single("userFile"), (req, res) => {
  console.log(req.file);
  console.log(req.body);
});
```

- ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•´ ì´ë¦„ ì¤‘ê°„ì— íƒ€ì„ìŠ¤íƒ¬í”„ê°’ì„ ë„£ì–´ì¤Œ
- `upload.single()` â‡’ `uploadDetail.single()`ë¡œ ë°”ê¿”ì¤€ë‹¤ (ì´ì œ upload ì•ˆì”€ ã…‡ã…‡)
- ê·¸ëƒ¥ ë³µë¶™í•´ì„œ ì“°ì

## 2ï¸âƒ£Â íŒŒì¼ ì—¬ëŸ¬ê°œ ì—…ë¡œë“œ

### ver1 (array)

```html
<!-- í´ë¼ì´ì–¸íŠ¸ -->
<form action="/upload/array" method="post" enctype="multipart/form-data" >
  <input type="file" name="userFiles" multiple /><br />
  <input type="text" name="title"/><br />
  <button type="submit">ì—…ë¡œë“œ</button>
</form>
```

- ì—¬ëŸ¬ê°œë¥¼ í•œ ë²ˆì— ë°›ì•„ì„œ í•œë²ˆì— ë³´ë‚¼ ë•Œ
- `multiple` : ë‹¤ì¤‘ íŒŒì¼ ì„ íƒ ì§€ì›
- req.bodyì— íƒ€ì´í‹€ ë„£ì–´ì„œ ë³´ëƒ„

```jsx
// ì„œë²„
app.post("/upload/array", uploadDetail.array("userFiles"), (req, res) => {
  console.log(req.files);
  console.log(req.body);
});
```

- `uploadDetail.**array**()` : ì—¬ëŸ¬ ì´ë¯¸ì§€ë¥¼ ë°°ì—´ë¡œ ê°€ì ¸ì˜´
    
    ![](https://github.com/cheolung12/blog-static/assets/109952479/ed74cf26-3634-4c76-99eb-d91946b9ca9c)
    

### ver2 (field)

```html
<!-- í´ë¼ì´ì–¸íŠ¸ -->
<form action="/upload/fields" method="post" enctype="multipart/form-data">
  <input type="file" name="userFile1" /><br />
  <input type="text" name="title1"/><br />
  <input type="file" name="userFile2" /><br />
  <input type="text" name="title2"/><br />
  <button type="submit">ì—…ë¡œë“œ</button>
</form>
```

- ì—¬ëŸ¬ê°œì˜ íŒŒì¼ì„ ê°ê° ë°›ì•„ì„œ í•œ ë²ˆì— ë³´ë‚´ì•¼í• ë•Œ

```jsx
// ì„œë²„
app.post(
  "/upload/fields",
  uploadDetail.fields([{ name: "userFile1" }, { name: "userFile2" }]),  
  (req, res) => {
    console.log(req.files);
    console.log(req.body);
  }
);
```

- `uploadDetail.**fields**()` : í•˜ë‚˜ì˜ ë°°ì—´ì•ˆì— ê°ê° íŒŒì¼ì„ ê°ì²´ë¡œ ë„£ëŠ”ë‹¤. ì´ ë•Œ, keyì˜ ì´ë¦„ì€ í•­ìƒ **name**
- ver1, ver2 ì°¨ì´
    
    <div className='flex justify-center '>![](https://github.com/cheolung12/blog-static/assets/109952479/9d7b3eac-5207-4f21-8261-db07c663816d)</div>
    

---

# ğŸ—‚ï¸Â ë™ì (ë¹„ë™ê¸°) íŒŒì¼ ì—…ë¡œë“œ (axios)

```html
<!-- í´ë¼ì´ì–¸íŠ¸ -->
<h1>ë™ì  íŒŒì¼ ì—…ë¡œë“œ</h1>
<input type="file" id="dynamic-file" /><br />
<input type="text" id="title"/><br />
<button type="button" onclick="fileupload()">ë™ì  íŒŒì¼ ì—…ë¡œë“œ</button>
<br />
<div class="result"></div>

...

<script>
    const resultBox = document.querySelector(".result");

    const fileupload = () => {
        const file = document.getElementById("dynamic-file");
        console.log(file);          // input íƒœê·¸ ë‚˜ì˜´
        console.log(file.files[0]); // ë°°ì—´í˜•íƒœì„
        const title = document.getElementById("title");

        // ë°›ëŠ”ìª½ì´ multer(multipart-formdata)ë¥¼ ë°›ê¸° ë•Œë¬¸ì— ì—¬ê¸°ì„œë„ ë§Œë“¤ì–´ì¤˜ì•¼ í•¨
        const formData = new FormData();
        formData.append('title', title.value);
        // formDataë¥¼ ì“¸ë•ŒëŠ” fileì€ í•­ìƒ ë§ˆì§€ë§‰ì— ì•ˆ ê·¸ëŸ¬ë©´ íŒŒì¼ ì•„ë˜ëŠ” ë‹¤ ë¬´ì‹œí•´ë²„ë¦¼
        // ì²«ë²ˆì§¸ ì¸ì : ë°±ì—”ë“œì—ì„œ ë°›ëŠ” ê°’ (ì¤‘ìš”!)
        formData.append('dynamic', file.files[0]); 
        
        axios({
            method: 'POST',
            url: '/dynamicFile',
            data: formData,
            headers: {
                'Content-Type' : 'multipart/form-data'
            }})
            .then((res) => {
                console.log(res);
                resultBox.innerHTML = `<div><img src=${res.data.path}></div>`
            })
        
    }
  </script>
```

- `FormData` í™œìš©!
- axiosì˜ headersì—  Content-Typeì„ ì¶”ê°€í•´ì¤˜ì•¼í•œë‹¤.

```jsx
// ì„œë²„

// ì •ì íŒŒì¼ ì„¤ì • (ë¯¸ë“¤ì›¨ì–´)
app.use('/uploads', express.static(__dirname + '/uploads'));

app.post("/dynamicFile", uploadDetail.single('dynamic'), (req, res) => {
    console.log(req.file);
    res.send(req.file);
  });
```

- ì •ì íŒŒì¼ ì„¤ì •ì„í•´ì„œ í´ë¼ì´ì–¸íŠ¸ë‹¨ì—ì„œë„ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©ê°€ëŠ¥í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.
- `uploadDetail.single(â€™â€™)` ì•ˆì—ëŠ” formDataì—ì„œ ì„¤ì •í–ˆë˜ ì²«ë²ˆì§¸ ì¸ìë¥¼ ì¤€ë‹¤.

## ğŸ§‘ğŸ»â€ğŸ’»Â ë™ì  ì „ì†¡ â†’ í¼ í™œìš©

```jsx
<h1>ë™ì  íŒŒì¼ ì—…ë¡œë“œ</h1>
    <form onsubmit="fileupload(event)">
        <input type="file"  id="dynamic">
        <input type="text" id="title" /><br />
        <button type="submit">ì—…ë¡œë“œ</button>
    </form>
<script>
        function fileupload(e) {
            e.preventDefault();
            const title = document.querySelector('#title').value;
            const file = document.querySelector('#dynamic');
            console.log(file.files[0]);
        }
... ë‚˜ë¨¸ì§€ëŠ” ë™ì¼
```

- formì„ í™œìš©í•˜ëŠ” ê²ƒì´ ë” ì˜¬ë°”ë¥¸ ì‘ì„±ë²•!
- ë‚˜ì¤‘ì— ë¦¬ì•¡íŠ¸ ì“¸ë•Œ ì´ë ‡ê²Œë§Œ ì“°ë‹ˆê¹Œ ë¯¸ë¦¬ ì—°ìŠµí•˜ì
- `onsubmit` ì´í›„ `preventDefault()` ë¡œ ë§‰ì•„ì£¼ëŠ” ë°©ì‹!